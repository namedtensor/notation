\documentclass{article}

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{mathtools}
\usepackage{parskip}
\usepackage[margin=1in]{geometry}
\usepackage{multicol}

\usepackage{namedtensor}

\newcommand{\reals}[0]{\mathbb{R}}

\title{Named Tensors: CNN / LeNet}
\date{}

\begin{document}
\maketitle

% \begin{multicols}{2}

\subsection*{Conv 2D}

\begin{align*} 
W &\in \reals^{\nset{channel}{c},\nset{kh}{kh}, \nset{kw}{kw}} \\
h' &= h-kh +1, w' = w-kw +1 \\
b &\in \reals^{\nset{height}{h'}, \nset{width}{w'}}  \\
\text{conv2d}(X; W, b) &=  W \ndot{channel, kh, kw} U + b \\
U &\in \reals^{{\nset{channel}{c}, \nset{height}{h'},
\nset{width}{w'}, \nset{kh}{kh}, \nset{kw}{kw}}}  \\
U_{\nidx{height}{i}, \nidx{width}{j}, \nidx{kh}{i'}, \nidx{kw}{j'}} &= X_{\nidx{height}{i+i' - 1}, \nidx{width}{j+j' - 1}}  
\end{align*}

\subsection*{Max Pooling}

\begin{align*} 
X &\in \reals^{\nset{height}{h}, \nset{width}{w}} \\
\text{maxpool2d}(X, kh, kw) &=  \nfun{kh, kw}{max}  U \\
U &\in \reals^{{\nset{height}{h / kh},
\nset{width}{w / kw}, \nset{kh}{kh}, \nset{kw}{kw}}}  \\
U_{\nidx{height}{i}, \nidx{width}{j}, \nidx{kh}{di}, \nidx{kw}{dj}} & = X_{\nidx{height}{i \times kh + di -1}, \nidx{width}{j \times kw + dj - 1}}  
\end{align*}

\subsection*{MLP}

\begin{align*} 
W^1 &\in \reals^{\nset{inp}{i}, \nset{hidden}{h}}, 
W^2 \in \reals^{ \nset{hidden}{h}} \\
\text{MLP}(X; W, b) &=  W^1 \ndot{hidden} \text{ReLU}(W^1 \ndot{inp} X + b^1) + b^2 
\end{align*}

\subsection*{Model}

\begin{align*} 
\textit{Params}: \\
W^1 & \in \reals^{\nset{channels'}{c_2}, \nset{channels}{c_1}, \nset{kh}{kh_1}, \nset{kw}{kw_1}} \\ 
W^2 & \in \reals^{\nset{channels'}{c_3}, \nset{channels}{c_2}, \nset{kh}{kh_2}, \nset{kw}{kw_2}} \\ 
U & \in \reals^{\nset{in}{h_1}, \nset{hidden}{h_2}},  V \in \reals^{\nset{hidden}{h_2}, \nset{out}{h_3}} \\ \\
\textit{Model}: \\
X^0 &\in \reals^{\nset{batch}{b}, \nset{channels}{1}, \nset{height}{h}, \nset{width}{w}}\\
X^1 &= \nmov{channels'}{channels}{\text{ReLU}(\text{conv2d}(X^0; W^1))} \\
X^2 &= \text{maxpool2d}(X^1, ph_1, ph_2) \\
X^3 &= \nmov{channels'}{channels}{\text{ReLU}(\text{conv2d}(X^2; W^2))} \\
X^4 &= \text{maxpool2d}(X^3, ph_2, ph_2) \\
X^5 &\in \reals^{\nset{batch}{b}, \nset{inp}{h_1}}\\ 
X^5_{\name{inp}} &= X^4_{\name{height}, \name{width}, \name{channels}}\\ 
O &= \nfun{class}{softmax} \nmov{out}{class}{\text{MLP}(X^5; U, V)}
\end{align*} 


% \end{multicols}
\end{document}
